<html>
<head>
	<title>
	Gauss Elimination Method
	</title>
	<style>
		table {
			border: 1px solid black;
			padding: 2px;
		}
		th {
			
		}
		td {
			text-align: center;
		}
		th {
			background-color: #CCCCCC;
			width: 75px;
		}
		.matrixInput {
			width: 75px;
		}
		p {
			margin: 16px 0px 0px 0px;
		}
	</style>
</head>

<body>
	<div id="input">
		<form name = "matrix size" action = "" method = "get">
		Matrix size:
		<br />
		<input type = "text" name = "inputbox" value = "">
		<br />
		<input type = "button" name = "button" value = "Click" onClick= "GetMatrixSize (this.form)">
		</form>
	</div>
	<div id="myDiv">
		<p>
			
		</p>
		<!--//<input type="button" id="create" value="Click here" onclick="Javascript:AddTable (matrix.length)">--!>
	</div>
	
	<script type="text/javascript">
	
		//====== GetMatrixSize ========================
		function GetMatrixSize (form) {
			var matrixSize = form.inputbox.value;
			main (matrixSize)
		}
	
		var myDiv = document.getElementById ("myDiv");
		
		var matrix = [[2,4,-4,0,2,1],
									[0,4,-3,0,6,0],
									[0,2,5,13,-3.5,0],
									[0,-2,-1,4,-0.5,-9],
									[1,5,0,1,-5,1],
									[1,0,2,0,-2,-2]];
		
		var usefulRows = matrix.length;
		var columns = matrix.length
		var currentCol = -1;
		
		function SetMatrix (matrixSize, inputMatrix) {
			matrix = JSON.parse (inputMatrix);
			for (var row = 0; row < matrixSize; row ++) {
				for (var col = 0; col < matrixSize; col ++) {
				}
			}
			usefulRows = matrixSize;
			columns = matrixSize;
			AddTable (matrixSize);
			TraverseMatrix ();
		}
		
		
		//====== MAIN =================================
		function main (matrixSize) {
			if (matrixSize > 0 && matrixSize < 20) {
				Explain ("Matrix size: " + matrixSize);
				Explain ("Fill in the matrix. You can leave 0 cells empty.")
				AddInputTable (matrixSize);
			} else {
				Explain ("You entered an invalid matrix size. We'll use the example matrix.");
				Explain ("Gauss Elimination Method:")
				AddTable (matrix.length);
				TraverseMatrix ();
			}
		}
		
		//====== TraverseMatrix =======================
		function TraverseMatrix () {
			for (var col = 0; col < columns ; col ++) {
				currentCol ++;
				for (var row = col + 1; row < usefulRows; row ++) {
					DecideWhatToDo (row, col);
				}
				
				Normalize (col);
			}
		}
		
		//====== DecideWhatToDo =======================
		function DecideWhatToDo (row, col) {
			if (matrix[row][col] !== 0) {
				addendRow = col;
				PutZeroRowsAtTop (col, col);
				IfDiagonalCellIsZero (row, col);
				
				if (!IsRowZero (col) && matrix[row][col] !== 0) {
					Normalize (col);
					AddRows (addendRow, row, matrix[row][col] / matrix[addendRow][col]);
				}
			}
		}
		
		//====== IfDiagonalCellIsZero =================
		function IfDiagonalCellIsZero (row, col) {
			if (matrix[col][col] == 0) {
				SwitchRows (row, col);
			}
		}
		
		//====== PutZeroRowsAtTop =====================
		function PutZeroRowsAtTop (row, col) {
			while (IsRowZero (col) && usefulRows > 0) { //put all-zero rows on the top
				usefulRows --;
				SwitchRows (col, usefulRows);
			}
		}
		
		//====== IsRowZero ============================
		function IsRowZero (row) {
			var rowIsZero = true;
			for (var col = 0; col < columns; col ++) {
				if (matrix[row][col] !== 0) {
					rowIsZero = false;
				}
			}
			return rowIsZero;
		}
		
		//====== AddRows ==============================
		function AddRows (addend, target, multiplier) {
			for (var col = 0; col < columns; col ++) {
				matrix[target][col] -= multiplier * matrix[addend][col];
			}
			
			Explain ("(row " + target + ") += (row " + addend + ") * (" + -multiplier + "):");
			AddTable (matrix.length, addend, target, currentCol);
		}
		
		//====== Normalize ============================
		function Normalize (row) {
			var multiplier = matrix[row][row];
			if (multiplier != 0 && multiplier != 1) {
				for (var col = 0; col < columns; col ++) {
					matrix[row][col] /= multiplier;
				}
				
				Explain ("Normalizing row " + row + ":");
				AddTable (matrix.length, row, -1, currentCol);
			}
		}
		
		//====== SwitchRows ===========================
		function SwitchRows (row1, row2) {
			var temp = 0;
			for (var col = 0; col < columns; col ++) {
				temp = matrix[row1][col];
				matrix[row1][col] = matrix[row2][col];
				matrix[row2][col] = temp;
			}
			
			Explain ("Switching row " + row1 + " with row " + row2 + ":");
			AddTable (matrix.length, row1, row2, currentCol);
		}
		
		//====== Explain ==============================
		function Explain (Explain) {
			var para = document.createElement ("p");
			myDiv.appendChild (para);
			var text = document.createTextNode (Explain);
			para.appendChild (text);
		}
		
		//====== AddTable =============================
		function AddTable (columns, currentRow1, currentRow2, currentCol) {
			var table = document.createElement ('table');
			var tableBody = document.createElement ('tbody');
			table.appendChild (tableBody);
			
			// columns
			var tr = document.createElement ('tr');
			tableBody.appendChild (tr);
			for (var i = 0; i < columns; i ++) {
				var th = document.createElement ('th');
				th.appendChild (document.createTextNode (i));
				if (i == currentCol) {
					th.style.color = "FF0000";
				}
				tr.appendChild (th);
			}
			
			// rows
			for (var mkRow = 0; mkRow < columns; mkRow ++) {
				var tr = document.createElement ('tr');
				for (var mkCol = 0; mkCol < columns; mkCol ++) {
					var td = document.createElement ('td');
					if (mkCol == mkRow) {
						td.style.background = "#E1E1E1";
					}
					console.log (matrix[mkRow][mkCol]);
					td.appendChild (document.createTextNode (matrix[mkRow][mkCol]));
					tr.appendChild (td)
					
					if (currentCol == mkCol && (currentRow1 == mkRow || currentRow2 == mkRow)) {
						td.style.color = "FF0000";
						td.style.fontWeight = "bold";
					}
				}
				
				if (currentRow1 == mkRow || currentRow2 == mkRow) {
					tr.style.background = "#FFFFC2";
				}
				
				tableBody.appendChild (tr);
			}
			
			myDiv.appendChild (table);
		}
		
		//====== AddInputTable ========================
		var inputMatrix = [];
		var inputCell = [];
		function AddInputTable (size) {
			var table = document.createElement ("table");
			var tableBody = document.createElement ("tbody");
			table.appendChild (tableBody);
			
			
			// columns
			var tr = document.createElement ("tr");
			tableBody.appendChild (tr);
			for (var i = 0; i < size; i ++) {
				var th = document.createElement ("th");
				th.appendChild (document.createTextNode (i));
				tr.appendChild (th);
			}
			
			// rows
			for (var mkRow = 0; mkRow < size; mkRow ++) {
				var tr = document.createElement ("tr");
				inputMatrix[mkRow] = [];
				inputCell[mkRow] = [];
				for (var mkCol = 0; mkCol < size; mkCol ++) {
					inputMatrix[mkRow][mkCol] = 0;
					var td = document.createElement ("td");
					inputCell[mkRow][mkCol] = document.createElement("input");
					inputCell[mkRow][mkCol].type = "number";
					inputCell[mkRow][mkCol].className = "matrixInput";
					td.appendChild (inputCell[mkRow][mkCol]);
					tr.appendChild (td);
				}
				tableBody.appendChild (tr);
			}
			myDiv.appendChild (table);
			
			function FillInputMatrixWithInputCells () {
				for (var mkRow = 0; mkRow < size; mkRow ++) {
					for (var mkCol = 0; mkCol < size; mkCol ++) {
						if (inputCell[mkRow][mkCol].value != "") {
							inputMatrix[mkRow][mkCol] = inputCell[mkRow][mkCol].value;
						}
					}
				}
			}
			
			var submitButton = document.createElement ("button");
			var buttonText = document.createTextNode ("Submit");
			submitButton.appendChild (buttonText);
			myDiv.appendChild (submitButton);
			submitButton.addEventListener ("click", GiveInputMatrixToSetMatrix);
			function GiveInputMatrixToSetMatrix () {
				FillInputMatrixWithInputCells ();
				SetMatrix (size, JSON.stringify (inputMatrix));
			}
			
		}
	</script>
</body>
</html>
